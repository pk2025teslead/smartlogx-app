{% extends 'adminpanel/base_admin.html' %}

{% block title %}Edit User{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="zoho-page-header" data-aos="fade-down">
    <div>
        <h1 class="zoho-page-title">Edit User</h1>
        <p class="zoho-page-subtitle">Update user information for {{ user.EMP_NAME }}</p>
    </div>
    <a href="{% url 'adminpanel:user_list' %}" class="zoho-btn zoho-btn-secondary">
        <i class="bi bi-arrow-left"></i>
        Back to Users
    </a>
</div>

<!-- Edit User Form -->
<div class="zoho-card zoho-form-card" data-aos="fade-up" data-aos-delay="100">
    <div class="zoho-card-header">
        <h2 class="zoho-card-title">
            <i class="bi bi-person-gear" style="margin-right: 8px; color: var(--zoho-accent);"></i>
            User Information
        </h2>
        <span class="zoho-badge coordinator" style="font-size: 11px;">ID: {{ user.ID }}</span>
    </div>
    <div class="zoho-card-body">
        <form method="POST" class="zoho-form" autocomplete="off">
            {% csrf_token %}
            
            <div class="zoho-form-row">
                <div class="zoho-form-group">
                    <label class="zoho-form-label required">Employee ID</label>
                    <input type="text" name="emp_id" class="zoho-form-input" placeholder="e.g., EMP001" 
                           value="{{ user.EMP_ID }}" required>
                </div>
                <div class="zoho-form-group">
                    <label class="zoho-form-label required">Employee Name</label>
                    <input type="text" name="emp_name" class="zoho-form-input" placeholder="Full Name" 
                           value="{{ user.EMP_NAME }}" required>
                </div>
            </div>
            
            <div class="zoho-form-row">
                <div class="zoho-form-group">
                    <label class="zoho-form-label required">Email Address</label>
                    <input type="email" name="email" class="zoho-form-input" placeholder="email@example.com" 
                           value="{{ user.EMAIL }}" required>
                </div>
                <div class="zoho-form-group">
                    <label class="zoho-form-label">Mobile Number</label>
                    <input type="text" name="mobile_number" class="zoho-form-input" placeholder="10-digit number" 
                           value="{{ user.MOBILE_NUMBER|default:'' }}" maxlength="10">
                </div>
            </div>
            
            <div class="zoho-form-row">
                <div class="zoho-form-group">
                    <label class="zoho-form-label required">Role</label>
                    <select name="role" class="zoho-form-input" required>
                        <option value="">Select Role</option>
                        {% for role in roles %}
                        <option value="{{ role }}" {% if user.ROLE == role %}selected{% endif %}>{{ role }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="zoho-form-group">
                    <label class="zoho-form-label">Roll / Department</label>
                    <input type="text" name="roll" class="zoho-form-input" placeholder="e.g., Backend Team" 
                           value="{{ user.ROLL|default:'' }}">
                </div>
            </div>
            
            <!-- Password Section -->
            <div style="background: var(--zoho-bg-secondary); border-radius: var(--zoho-radius-md); padding: 20px; margin-top: 24px; border: 1px solid var(--zoho-border);">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
                    <div>
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--zoho-text-primary); margin-bottom: 4px;">
                            <i class="bi bi-shield-lock" style="margin-right: 6px;"></i>
                            Password Management
                        </h4>
                        <p style="font-size: 13px; color: var(--zoho-text-muted); margin: 0;">
                            Password cannot be edited directly. Use reset to set temporary password.
                        </p>
                    </div>
                    <button type="button" class="zoho-btn zoho-btn-secondary" onclick="confirmResetPassword({{ user.ID }}, '{{ user.EMP_NAME }}')">
                        <i class="bi bi-key"></i>
                        Reset Password
                    </button>
                </div>
                
                {% if user.IS_FIRST_LOGIN %}
                <div style="margin-top: 12px; padding: 10px 14px; background: rgba(245, 158, 11, 0.1); border-radius: var(--zoho-radius-sm); border-left: 3px solid var(--zoho-neon-yellow);">
                    <span style="font-size: 13px; color: var(--zoho-neon-yellow);">
                        <i class="bi bi-exclamation-triangle"></i>
                        User has not changed their initial password yet
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div class="zoho-btn-group" style="margin-top: 32px;">
                <button type="submit" class="zoho-btn zoho-btn-primary">
                    <i class="bi bi-check-lg"></i>
                    Update User
                </button>
                <a href="{% url 'adminpanel:user_list' %}" class="zoho-btn zoho-btn-secondary">
                    Cancel
                </a>
            </div>
        </form>
        
        <!-- Hidden form for password reset -->
        <form id="reset-form-{{ user.ID }}" action="{% url 'adminpanel:reset_password' user.ID %}" method="POST" style="display: none;">
            {% csrf_token %}
        </form>
    </div>
</div>

<!-- User Meta Info -->
<div class="zoho-card" style="max-width: 600px; margin: 24px auto 0;" data-aos="fade-up" data-aos-delay="200">
    <div class="zoho-card-body" style="padding: 16px 20px;">
        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
            <div>
                <span style="font-size: 12px; color: var(--zoho-text-muted); display: block;">Created At</span>
                <span style="font-size: 14px; color: var(--zoho-text-primary);">
                    {% if user.CREATED_AT %}{{ user.CREATED_AT|date:"M d, Y H:i" }}{% else %}-{% endif %}
                </span>
            </div>
            <div>
                <span style="font-size: 12px; color: var(--zoho-text-muted); display: block;">Last Updated</span>
                <span style="font-size: 14px; color: var(--zoho-text-primary);">
                    {% if user.UPDATED_AT %}{{ user.UPDATED_AT|date:"M d, Y H:i" }}{% else %}-{% endif %}
                </span>
            </div>
            <div>
                <span style="font-size: 12px; color: var(--zoho-text-muted); display: block;">First Login Status</span>
                <span style="font-size: 14px; color: {% if user.IS_FIRST_LOGIN %}var(--zoho-neon-yellow){% else %}var(--zoho-neon-green){% endif %};">
                    {% if user.IS_FIRST_LOGIN %}Pending{% else %}Completed{% endif %}
                </span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
